<section class="favorites">
    <div class="favorites-header">
        <h2>Mis favoritos</h2>
    </div>

    <p class="error" *ngIf="error">{{ error }}</p>
    <p class="loading" *ngIf="loading">Cargando...</p>
    <p class="empty" *ngIf="!loading && !error && favorites.length === 0">
        No tienes libros en favoritos.
    </p>

    <ul class="favorites-list">
        <li class="favorite-item" *ngFor="let book of favorites" (click)="openModal(book)">
            <img
                class="favorite-cover"
                [src]="getCoverUrl(book.coverUrl)"
                alt="Book cover"
                (error)="book.coverUrl = null"
            >
            <div class="favorite-info">
                <h3>{{ book.title }}</h3>
                <p>Autor: <span>{{ book.authors }}</span></p>
                <p>Año de publicación: <span>{{ book.firstPublishYear }}</span></p>
            </div>
        </li>
    </ul>

    <div class="modal-backdrop" *ngIf="selectedBook" (click)="closeModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <button class="modal-close" (click)="closeModal()">x</button>
            <h3 class="modal-title">{{ selectedBook.title }}</h3>
            <div class="modal-body">
                <div class="modal-left">
                    <img
                        class="result-cover"
                        [src]="getCoverUrl(selectedBook.coverUrl)"
                        alt="Book cover"
                        (error)="selectedBook.coverUrl = null"
                    >
                    <button
                        class="favorite-button is-favorite"
                        (click)="requestRemove(selectedBook); $event.stopPropagation()"
                    >
                        <svg class="favorite-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 2.75l2.99 6.06 6.69.97-4.84 4.72 1.14 6.64L12 17.98l-5.98 3.16 1.14-6.64-4.84-4.72 6.69-.97L12 2.75z"></path>
                        </svg>
                        Quitar de favoritos
                    </button>
                </div>
                <div class="modal-right">
                    <p>Autor: <span>{{ selectedBook.authors }}</span></p>
                    <p>Año de publicación: <span>{{ selectedBook.firstPublishYear }}</span></p>
                    <div class="modal-description" *ngIf="selectedBook.description">
                        <span class="modal-label">Descripcion:</span>
                        <span>{{ selectedBook.description }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" *ngIf="confirmBook" (click)="cancelRemove()">
        <div class="confirm-modal" (click)="$event.stopPropagation()">
            <h3>Confirmar eliminación</h3>
            <p>¿Seguro que deseas quitar este libro de favoritos?</p>
            <div class="confirm-actions">
                <button class="confirm-cancel" (click)="cancelRemove()">Cancelar</button>
                <button class="confirm-delete" (click)="confirmRemove()">Eliminar</button>
            </div>
        </div>
    </div>
</section>
